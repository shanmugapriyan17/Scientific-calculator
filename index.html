<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="description" content="A fully functional scientific calculator with a clean design, history, and keyboard shortcuts."/>
  <meta name="keywords" content="scientific, calculator, HTML, CSS, JavaScript, math, physics, equations, functions"/>
  <meta name="author" content="shanmugapriyan"/>
  <meta property="og:title" content="Scientific Calculator"/>
  <meta property="og:description" content="A fully functional scientific calculator with a clean design, history, and keyboard shortcuts."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://scientific-calculator-mu-five.vercel.app/"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="Scientific Calculator"/>
  <meta name="twitter:description" content="A fully functional scientific calculator with a clean design, history, and keyboard shortcuts."/>
  <meta name="twitter:site" content="@20imt32"/>
  <title>Scientific Calculator</title>

  <link rel="stylesheet" href="./style.css">

   <!-- icon -->

   <link rel="icon" href="./IMG/mathemetic.png" />
   <link
     href="https://fonts.googleapis.com/css2?family=Figtree:ital,wght@0,300..900;1,300..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Work+Sans:ital,wght@0,100..900;1,100..900&family=Zeyada&display=swap"
     rel="stylesheet"
   />

   <!-- font -->
   <link rel="preconnect" href="https://fonts.googleapis.com" />
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
   <link
     href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@100..900&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
     rel="stylesheet"
   />

  
</head>
<body>
  <div class="wrap">
    <header>
      <h1>SCIENTIFIC CALCULATOR</h1>
      <p>Shortcuts : Alt+A Append, Alt+P Prepend, Alt+R Reverse</p>
    </header>

    <div class="calc" id="calc">
      <div class="left">
        <div class="display-box">
          <input id="expr" type="text" inputmode="decimal" autocomplete="off" autocapitalize="off" spellcheck="false" />
        </div>

        <div class="control-row" aria-hidden="false">
          <div style="margin-left:auto;display:flex;gap:8px;flex-wrap:wrap;">
            <button class="ctrl-btn" id="btnAppend">Append</button>
            <button class="ctrl-btn" id="btnPrepend">Prepend</button>
            <button class="ctrl-btn" id="btnReverse">Reverse</button>
          </div>
        </div>

        <div class="keys" id="keys" aria-label="Calculator keys">
          <button class="key" data-key="(">(</button>
          <button class="key" data-key=")">)</button>
          <button class="key sep" data-key="MC">MC</button>
          <button class="key sep" data-key="MR">MR</button>

          <button class="key" data-key="sin">sin</button>
          <button class="key" data-key="cos">cos</button>
          <button class="key" data-key="tan">tan</button>
          <button class="key" data-key="ln">ln</button>

          <button class="key" data-key="√">√</button>
          <button class="key" data-key="x²">x²</button>
          <button class="key" data-key="x^y">xʸ</button>
          <button class="key" data-key="log">log</button>

          <button class="key" data-key="AC">AC</button>
          <button class="key" data-key="Backspace">⌫</button>
          <button class="key" data-key="%">%</button>
          <button class="key op" data-key="÷">÷</button>

          <button class="key" data-key="7">7</button>
          <button class="key" data-key="8">8</button>
          <button class="key" data-key="9">9</button>
          <button class="key op" data-key="×">×</button>

          <button class="key" data-key="4">4</button>
          <button class="key" data-key="5">5</button>
          <button class="key" data-key="6">6</button>
          <button class="key op" data-key="-">-</button>

          <button class="key" data-key="1">1</button>
          <button class="key" data-key="2">2</button>
          <button class="key" data-key="3">3</button>
          <button class="key op" data-key="+">+</button>

          <button class="key w2" data-key="0">0</button>
          <button class="key" data-key=".">.</button>
          <button class="key op" data-key="=">=</button>
        </div>
      </div>

      <div class="right" aria-live="polite">
        <h4 class="history-title">History</h4>
        <div id="history"></div>
        <div class="hint">
          Tip: Click a history row to reuse its expression. Use <strong>Alt + A/P/R</strong> for Append/Prepend/Reverse.
        </div>
      </div>
    </div>
  </div>

  <script>
  (function(){
    // Elements
    const exprEl = document.getElementById('expr');
    const keysEl = document.getElementById('keys');
    const historyEl = document.getElementById('history');
    const btnAppend = document.getElementById('btnAppend');
    const btnPrepend = document.getElementById('btnPrepend');
    const btnReverse = document.getElementById('btnReverse');

    // State for append/prepend mode
    let currentMode = 'none';

    // Keep focus on expr ONLY when the user clicks the input field
    function safeFocus(){ try { exprEl.focus(); } catch(e) {} }

    // Unified mode toggling and visual feedback
    function setMode(mode) {
      // Deselect all buttons first
      btnAppend.classList.remove('primary');
      btnPrepend.classList.remove('primary');
      
      // If the same mode is clicked, turn it off. Otherwise, set the new mode.
      currentMode = (currentMode === mode) ? 'none' : mode;

      if (currentMode === 'append') {
        btnAppend.classList.add('primary');
      } else if (currentMode === 'prepend') {
        btnPrepend.classList.add('primary');
      }
      exprEl.blur(); // Blur the input field to hide the keyboard
    }

    // Append/Prepend/Reverse actions now use the expression box value
    function doAppend(){ 
      setMode('append');
    }
    function doPrepend(){ 
      setMode('prepend');
    }
    function doReverse(){ 
      exprEl.value = String(exprEl.value || '').split('').reverse().join(''); 
      setMode('none');
      btnFlash(btnReverse);
      exprEl.blur(); // Blur the input field to hide the keyboard
    }

    btnAppend.addEventListener('click', (e)=>{ e.preventDefault(); doAppend(); });
    btnPrepend.addEventListener('click', (e)=>{ e.preventDefault(); doPrepend(); });
    btnReverse.addEventListener('click', (e)=>{ e.preventDefault(); doReverse(); });

    function btnFlash(el){
      el.classList.add('primary-flash');
      setTimeout(()=>el.classList.remove('primary-flash'), 160);
    }

    // Unified token insertion used by keypad + keyboard
    function insertToken(token){
      let s = exprEl.value || '';

      // Append/Prepend mode logic for numbers only
      if(/^\d$/.test(token) || token === '.') {
        if(currentMode === 'append'){
          exprEl.value = s + token;
        } else if (currentMode === 'prepend') {
          exprEl.value = token + s;
        } else {
          exprEl.value = s + token;
        }
        return;
      }
      
      // All other tokens (operators, functions, etc.) reset the mode
      currentMode = 'none';
      btnAppend.classList.remove('primary');
      btnPrepend.classList.remove('primary');


      const displayOp = (t) => t === '*' ? '×' : t === '/' ? '÷' : t;

      if(token === 'Backspace'){
        doBackspace();
        return;
      }
      if(token === '('){
        if(s && /[0-9\)\.πe]$/.test(s)) exprEl.value = s + '×(';
        else exprEl.value = s + '(';
        return;
      }
      if(token === ')'){ exprEl.value = s + ')'; return; }

      if(['+','-','×','÷','^'].includes(token)){
        const disp = displayOp(token);
        if(!s && disp === '-') { exprEl.value = '-'; return; }
        if(s && /[+\-×÷^]$/.test(s)){
          if(disp === '-' && /[(+]$/.test(s)){ exprEl.value = s + '-'; return; }
          exprEl.value = s.slice(0,-1) + disp; return;
        }
        exprEl.value = s + disp; return;
      }

      if(token === 'AC'){ exprEl.value = ''; return; }
      if(token === '+/-'){
        if(!s){ exprEl.value = '-'; return; }
        const m = s.match(/(.+?)(-?)(\(?[0-9\.πe]+\)?)$/);
        if(m){ let prefix=m[1]||''; let sign=m[2]||''; let num=m[3]||''; sign = (sign==='-') ? '' : '-'; exprEl.value = prefix + sign + num; return; }
        return;
      }
      if(token === '%'){ const m = s.match(/(.+?)([0-9\.πe]+|\([^\)]+\))$/); if(m) exprEl.value = m[1] + '(' + m[2] + '/100)'; return; }
      if(token === '√'){ exprEl.value = s + '√('; return; }
      if(token === 'x²'){ exprEl.value = s + '^2'; return; }
      if(token === 'x^y'){ exprEl.value = s + '^'; return; }
      if(['sin','cos','tan','ln','log'].includes(token)){
        if(s && /[0-9\)πe]$/.test(s)) exprEl.value = s + '×' + token + '(';
        else exprEl.value = s + token + '(';
        return;
      }
      if(token === '='){ evaluateExpression(); return; }
    }

    function doBackspace(){ 
      exprEl.value = (exprEl.value||'').slice(0,-1); 
      // Backspace also resets the mode
      currentMode = 'none';
      btnAppend.classList.remove('primary');
      btnPrepend.classList.remove('primary');
    }

    // Evaluator (same robust logic as before)
    function evaluateExpression(){
      const raw = exprEl.value || '';
      if(!raw) return;
      let s = String(raw);

      s = s.replace(/×/g,'*').replace(/÷/g,'/').replace(/\^/g,'**').replace(/√\(/g,'sqrt(');
      s = s.replace(/π/g,'Math.PI');
      s = s.replace(/\bln\(/g,'Math.log(');
      s = s.replace(/\blog\(/g,'Math.log10(');
      s = s.replace(/\bsin\(/g,'Math.sin(');
      s = s.replace(/\bcos\(/g,'Math.cos(');
      s = s.replace(/\btan\(/g,'Math.tan(');
      s = s.replace(/\bsqrt\(/g,'Math.sqrt(');

      if(typeof Math.log10 !== 'function'){
        Math.log10 = function(x){ return Math.log(x)/Math.LN10; };
      }

      const factFunc = function(n){ if(n < 0) return NaN; n = Math.floor(n); let f=1; for(let i=2;i<=n;i++) f*=i; return f; };
      let reFact = /(\d+(\.\d+)?|\([^\(\)]+\))!/;
      while(reFact.test(s)){ s = s.replace(reFact, function(m,p1){ return 'fact(' + p1 + ')'; }); }

      const leftoverLetters = s.replace(/Math|fact/g,'').match(/[A-Za-z]/);
      if(leftoverLetters){ showTemp('Error'); return; }

      const safeWrap = '\"use strict\"; const fact=' + factFunc.toString() + '; return (' + s + ');';
      try{
        const fn = new Function(safeWrap);
        let val = fn();
        if(typeof val === 'number'){
          if(!Number.isFinite(val)){ showTemp('Error'); return; }
          val = Math.round((val + Number.EPSILON) * 1e12) / 1e12;
          addHistory(raw + ' = ' + val);
          exprEl.value = String(val);
        } else {
          exprEl.value = String(val);
        }
      }catch(err){ showTemp('Error'); }
    }

    function addHistory(text){
      const row = document.createElement('div');
      row.style.padding = '6px 4px';
      row.style.borderBottom = '1px solid rgba(255,255,255,0.02)';
      row.style.cursor = 'pointer';
      row.style.fontSize = '14px';
      row.innerHTML = text;
      row.addEventListener('click', () => { const parts = text.split(' = '); exprEl.value = parts[0] || ''; safeFocus(); });
      historyEl.prepend(row);
    }

    function showTemp(msg){
      const prev = exprEl.value;
      exprEl.value = msg;
      setTimeout(()=>{ if(document.activeElement !== exprEl) exprEl.value = prev; }, 900);
    }

    // keypad click handler
    keysEl.addEventListener('click', (ev) => {
      ev.preventDefault();
      const btn = ev.target.closest('button.key');
      if(!btn) return;
      const token = btn.dataset.key || btn.textContent.trim();
      insertToken(token);
      // Remove focus from the input field after button click
      exprEl.blur();
    }, {passive:false});

    // keyboard handling
    const keyMap = { '*': '×', '/': '÷', 'Enter': '=', 'Backspace': 'Backspace', 'Escape': 'AC', 'Delete': 'AC' };

    document.addEventListener('keydown', (ev) => {
      const k = ev.key;
      // Alt shortcuts for append/prepend/reverse
      if(ev.altKey && (k === 'a' || k === 'A')){ ev.preventDefault(); doAppend(); return; }
      if(ev.altKey && (k === 'p' || k === 'P')){ ev.preventDefault(); doPrepend(); return; }
      if(ev.altKey && (k === 'r' || k === 'R')){ ev.preventDefault(); doReverse(); return; }

      if(/^\d$/.test(k) || ['+','-','*','/','^','(',')','.','Enter','Backspace','Escape','Delete','%'].includes(k)){
        ev.preventDefault();
        const mapped = keyMap[k] || k;
        // visual highlight
        highlightByToken(mapped, true);
        if(k === '*') insertToken('×');
        else if(k === '/') insertToken('÷');
        else if(k === 'Enter') insertToken('=');
        else if(k === 'Backspace') doBackspace();
        else if(k === 'Escape' || k === 'Delete') insertToken('AC');
        else insertToken(k);
        exprEl.blur();
        return;
      }

      // letter shortcuts for functions (s/c/t/l/g)
      if(!ev.altKey && ['s','c','t','l','g'].includes(k.toLowerCase())){
        ev.preventDefault();
        const map = { s:'sin', c:'cos', t:'tan', l:'ln', g:'log' };
        insertToken(map[k.toLowerCase()]);
        highlightByToken(map[k.toLowerCase()], true);
        setTimeout(()=>highlightByToken(map[k.toLowerCase()], false), 120);
        exprEl.blur();
      }
    }, {passive:false});

    document.addEventListener('keyup', (ev) => {
      const k = ev.key;
      const mapped = keyMap[k] || k;
      highlightByToken(mapped, false);
      if(['s','c','t','l','g'].includes(k.toLowerCase())){
        const map = { s:'sin', c:'cos', t:'tan', l:'ln', g:'log' };
        highlightByToken(map[k.toLowerCase()], false);
      }
    });

    function highlightByToken(label, on){
      // try data-key match, else match text for small palette items or ctrl buttons
      const byKey = document.querySelector('[data-key="'+CSS.escape(label)+'"]');
      if(byKey){ byKey.classList.toggle('active', !!on); return; }
      const byFunc = document.querySelector('[data-func="'+CSS.escape(label)+'"]');
      if(byFunc){ byFunc.classList.toggle('active', !!on); return; }
      const byText = Array.from(document.querySelectorAll('.key, .small-key, .pal-item, .ctrl-btn')).find(b => (b.textContent||'').trim() === label);
      if(byText) byText.classList.toggle('active', !!on);
    }

    // Call safeFocus ONLY on click, not page load
    exprEl.addEventListener('click', safeFocus);

    // ensure Enter doesn't reload page
    window.addEventListener('keydown', (e) => { if(e.key === 'Enter' && document.activeElement && document.activeElement.tagName !== 'TEXTAREA') e.preventDefault(); });

  })();
  </script>
</body>
</html>